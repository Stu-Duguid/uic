/*!
 * Copyright (c) 2021 Acoustic, L.P. All rights reserved.
 *
 * NOTICE: This file contains material that is confidential and proprietary to
 * Acoustic, L.P. and/or other developers. No license is granted under any intellectual or
 * industrial property rights of Acoustic, L.P. except as may be provided in an agreement with
 * Acoustic, L.P. Any unauthorized copying or distribution of content from this file is
 * prohibited.
 *
 */
TLT.addModule("behaviours",(function(context){"use strict";var moduleLoaded,moduleConfig,rageclick,deadclick,errorclick,excessscroll,thrashing;function initRage(event){(rageclick=moduleConfig.rageclick||{enable:!1}).enable&&(rageclick.clicks=moduleConfig.rageclick.clicks||4,rageclick.distance=moduleConfig.rageclick.distance||20,rageclick.time=moduleConfig.rageclick.time||800,rageclick.blocklist=moduleConfig.rageclick.blocklist||[],rageclick.count=0,rageclick.lastTime=0,moduleLoaded=!0)}function checkForRage(event){if("unload"!==event.type){for(var i=0;i<rageclick.blocklist.length;i++)if(event.target.id.match(rageclick.blocklist[i]))return;if(0===rageclick.count||Math.abs(event.position.x-rageclick.x)>rageclick.distance||Math.abs(event.position.y-rageclick.y)>rageclick.distance||event.timestamp-rageclick.lastTime>rageclick.time)return rageclick.x=event.position.x,rageclick.y=event.position.y,void(rageclick.count=1);rageclick.count++,rageclick.x=event.position.x,rageclick.y=event.position.y,rageclick.count===rageclick.clicks&&(console.debug("behaviour: rage clicks seen"),context.post({type:5,customEvent:{name:"rageclick",data:{description:"Rage click - "+event.target.id,value:{target:event.target.id}}}}),rageclick.count=0)}else rageclick.count=0}function initDead(event){(deadclick=moduleConfig.deadclick||{enable:!1}).enable&&(deadclick.time=moduleConfig.deadclick.time||2e3,deadclick.blocklist=moduleConfig.deadclick.blocklist||[],deadclick.unresolvedClick=!1,deadclick.lastTime=0,moduleLoaded=!0)}function checkForDead(event){var timer=null,observer=null;if("click"===event.type){if(timer)return;if("input"===event.target.type&&"button"!==event.target.subType||"select"===event.target.type||"label"===event.target.type)return;for(var i=0;i<deadclick.blocklist.length;i++)if(event.target.id.match(deadclick.blocklist[i]))return;return deadclick.unresolvedClick=!0,deadclick.target=event.target.id,(observer=new MutationObserver((function(){deadclick.unresolvedClick=!1,observer.disconnect()}))).observe(document.body,{subtree:!0,childList:!0,attributeFilter:["style","class"]}),void(timer=setTimeout((function deadTimeCheck(){deadclick.unresolvedClick&&(console.debug("behaviour: dead click seen"),context.post({type:5,customEvent:{name:"deadclick",data:{description:"Dead click - "+deadclick.target,value:{target:deadclick.target}}}})),timer=null,deadclick.unresolvedClick=!1}),deadclick.time))}"unload"===event.type&&timer&&(clearTimeout(timer),timer=null,deadclick.unresolvedClick=!1)}function initError(event){(errorclick=moduleConfig.errorclick||{enable:!1}).enable&&(errorclick.time=moduleConfig.errorclick.time||200,errorclick.blocklist=moduleConfig.errorclick.blocklist||[],errorclick.target=null,errorclick.clickTime=0,moduleLoaded=!0)}function checkForError(event){if("click"===event.type)return errorclick.target=event.target.id,void(errorclick.clickTime=event.timestamp);if("error"!==event.type)"unload"===event.type&&(errorclick.target=null);else{for(var i=0;i<errorclick.blocklist.length;i++)if(event.nativeEvent.message.match(errorclick.blocklist[i]))return;if(errorclick.target&&event.nativeEvent.message){if(event.timestamp-errorclick.clickTime<errorclick.time)return console.debug("behaviour: error click seen"),void context.post({type:5,customEvent:{name:"errorclick",data:{description:"Error click - "+errorclick.target,value:{target:errorclick.target,url:event.nativeEvent.filename,line:event.nativeEvent.lineno,description:event.nativeEvent.message}}}});errorclick.target=null}}}function initScroll(event){(excessscroll=moduleConfig.excessscroll||{enable:!1}).enable&&(excessscroll.scale=moduleConfig.excessscroll.scale||2.4,excessscroll.blocklist=moduleConfig.excessscroll.blocklist||[],excessscroll.distance=0,excessscroll.lastpos=0,moduleLoaded=!0)}function checkForScroll(event){for(var i=0;i<excessscroll.blocklist.length;i++)if(document.location.href.match(excessscroll.blocklist[i]))return;return"scroll"===event.type?(excessscroll.distance+=Math.abs(window.scrollY-excessscroll.lastpos),excessscroll.lastpos=window.scrollY,void(excessscroll.distance>document.body.scrollHeight*excessscroll.scale&&(console.debug("behaviour: excess scroll seen"),context.post({type:5,customEvent:{name:"excessscroll",data:{description:"Excess scrolling",value:{distance:excessscroll.distance,pageheight:document.body.scrollHeight,viewport:window.visualViewport&&window.visualViewport.height?window.visualViewport.height:0}}}}),excessscroll.distance=0))):"orientationchange"===event.type?(excessscroll.distance=window.scrollY,void(excessscroll.lastpos=window.scrollY)):void("unload"===event.type&&(excessscroll.distance=0,excessscroll.lastpos=0))}function initThrash(event){(thrashing=moduleConfig.thrashing||{enable:!1}).enable&&(thrashing.time=moduleConfig.thrashing.time||4e3,thrashing.blocklist=moduleConfig.thrashing.blocklist||[],thrashing.threshold=10*Math.PI,thrashing.moves=0,thrashing.x=0,thrashing.y=0,thrashing.lastDirection=0,thrashing.total=0,thrashing.seen=[],moduleLoaded=!0)}function checkForThrash(event){for(var i=0;i<thrashing.blocklist.length;i++)if(document.location.href.match(thrashing.blocklist[i]))return;if("mousemove"!==event.type)"unload"===event.type&&(thrashing.seen=[],thrashing.total=0,thrashing.moves=0,thrashing.x=0,thrashing.y=0);else{if(thrashing.x+=event.nativeEvent.movementX,thrashing.y+=event.nativeEvent.movementY,thrashing.moves++,thrashing.moves<10)return;var theta=Math.atan2(thrashing.y,thrashing.x);thrashing.moves=0,thrashing.x=0,thrashing.y=0;var delta=thrashing.seen.length>0?Math.abs((theta-thrashing.lastDirection)%Math.PI):0;for(thrashing.lastDirection=theta,thrashing.total+=delta,thrashing.seen.push({time:event.timestamp,delta:delta});thrashing.seen.length>1&&event.timestamp-thrashing.seen[0].time>thrashing.time;)thrashing.total-=thrashing.seen[0].delta,thrashing.seen.shift();thrashing.total>thrashing.threshold&&(console.debug("behaviour: thrashing seen"),context.post({type:5,customEvent:{name:"thrashing",data:{description:"Thrashing pointer",value:{amount:thrashing.total}}}}),thrashing.seen=[],thrashing.total=0)}}return{init:function(){moduleLoaded=!1,moduleConfig=context.getConfig(),initRage(),initDead(),initError(),initScroll(),initThrash()},destroy:function(){moduleLoaded=!1},onevent:function(event){if("object"==typeof event&&event.type&&moduleLoaded){if("click"===event.type)return checkForRage(event),checkForDead(event),void checkForError(event);if("error"!==event.type)if("scroll"!==event.type&&"orientationchange"!==event.type){if("mousemove"!==event.type)return"unload"===event.type?(checkForRage(event),checkForDead(event),checkForError(event),checkForScroll(event),void checkForThrash(event)):void 0;checkForThrash(event)}else checkForScroll(event);else checkForError(event)}},version:"1.0"}}));