/*!
 * Copyright (c) 2021 Acoustic, L.P. All rights reserved.
 *
 * NOTICE: This file contains material that is confidential and proprietary to
 * Acoustic, L.P. and/or other developers. No license is granted under any intellectual or
 * industrial property rights of Acoustic, L.P. except as may be provided in an agreement with
 * Acoustic, L.P. Any unauthorized copying or distribution of content from this file is
 * prohibited.
 *
 */
TLT.addModule("behaviours",(function(e){"use strict";var t,i,n,o,l,s,c;function a(e){(n=i.rageclick||{enable:!1}).enable&&(n.clicks=i.rageclick.clicks||4,n.distance=i.rageclick.distance||20,n.time=i.rageclick.time||800,n.blocklist=i.rageclick.blocklist||[],n.count=0,n.lastTime=0,t=!0)}function r(t){if("unload"!==t.type){for(var i=0;i<n.blocklist.length;i++)if(t.target.id.match(n.blocklist[i]))return;if(0===n.count||Math.abs(t.position.x-n.x)>n.distance||Math.abs(t.position.y-n.y)>n.distance||t.timestamp-n.lastTime>n.time)return n.x=t.position.x,n.y=t.position.y,void(n.count=1);n.count++,n.x=t.position.x,n.y=t.position.y,n.count===n.clicks&&(console.debug("behaviour: rage clicks seen"),e.post({type:5,customEvent:{name:"rageclick",data:{description:"Rage click - "+t.target.id,value:{target:t.target.id}}}}),n.count=0)}else n.count=0}function u(e){(o=i.deadclick||{enable:!1}).enable&&(o.time=i.deadclick.time||2e3,o.blocklist=i.deadclick.blocklist||[],o.unresolvedClick=!1,o.lastTime=0,t=!0)}function d(t){var i=null,n=null;if("click"===t.type){if(i)return;if("input"===t.target.type&&"button"!==t.target.subType||"select"===t.target.type||"label"===t.target.type)return;for(var l=0;l<o.blocklist.length;l++)if(t.target.id.match(o.blocklist[l]))return;return o.unresolvedClick=!0,o.target=t.target.id,(n=new MutationObserver((function(){o.unresolvedClick=!1,n.disconnect()}))).observe(document.body,{subtree:!0,childList:!0,attributeFilter:["style","class"]}),void(i=setTimeout((function t(){o.unresolvedClick&&(console.debug("behaviour: dead click seen"),e.post({type:5,customEvent:{name:"deadclick",data:{description:"Dead click - "+o.target,value:{target:o.target}}}})),i=null,o.unresolvedClick=!1}),o.time))}"unload"===t.type&&i&&(clearTimeout(i),i=null,o.unresolvedClick=!1)}function v(e){(l=i.errorclick||{enable:!1}).enable&&(l.time=i.errorclick.time||200,l.blocklist=i.errorclick.blocklist||[],l.target=null,l.clickTime=0,t=!0)}function m(t){if("click"===t.type)return l.target=t.target.id,void(l.clickTime=t.timestamp);if("error"!==t.type)"unload"===t.type&&(l.target=null);else{for(var i=0;i<l.blocklist.length;i++)if(t.nativeEvent.message.match(l.blocklist[i]))return;if(l.target&&t.nativeEvent.message){if(t.timestamp-l.clickTime<l.time)return console.debug("behaviour: error click seen"),void e.post({type:5,customEvent:{name:"errorclick",data:{description:"Error click - "+l.target,value:{target:l.target,url:t.nativeEvent.filename,line:t.nativeEvent.lineno,description:t.nativeEvent.message}}}});l.target=null}}}function g(e){(s=i.excessscroll||{enable:!1}).enable&&(s.scale=i.excessscroll.scale||2.4,s.blocklist=i.excessscroll.blocklist||[],s.distance=0,s.lastpos=0,t=!0)}function p(t){for(var i=0;i<s.blocklist.length;i++)if(document.location.href.match(s.blocklist[i]))return;return"scroll"===t.type?(s.distance+=Math.abs(window.scrollY-s.lastpos),s.lastpos=window.scrollY,void(s.distance>document.body.scrollHeight*s.scale&&(console.debug("behaviour: excess scroll seen"),e.post({type:5,customEvent:{name:"excessscroll",data:{description:"Excess scrolling",value:{distance:s.distance,pageheight:document.body.scrollHeight,viewport:window.visualViewport&&window.visualViewport.height?window.visualViewport.height:0}}}}),s.distance=0))):"orientationchange"===t.type?(s.distance=window.scrollY,void(s.lastpos=window.scrollY)):void("unload"===t.type&&(s.distance=0,s.lastpos=0))}function b(e){(c=i.thrashing||{enable:!1}).enable&&(c.time=i.thrashing.time||4e3,c.blocklist=i.thrashing.blocklist||[],c.threshold=10*Math.PI,c.moves=0,c.x=0,c.y=0,c.lastDirection=0,c.total=0,c.seen=[],t=!0)}function h(t){for(var i=0;i<c.blocklist.length;i++)if(document.location.href.match(c.blocklist[i]))return;if("mousemove"!==t.type)"unload"===t.type&&(c.seen=[],c.total=0,c.moves=0,c.x=0,c.y=0);else{if(c.x+=t.nativeEvent.movementX,c.y+=t.nativeEvent.movementY,c.moves++,c.moves<10)return;var n=Math.atan2(c.y,c.x);c.moves=0,c.x=0,c.y=0;var o=c.seen.length>0?Math.abs((n-c.lastDirection)%Math.PI):0;for(c.lastDirection=n,c.total+=o,c.seen.push({time:t.timestamp,delta:o});c.seen.length>1&&t.timestamp-c.seen[0].time>c.time;)c.total-=c.seen[0].delta,c.seen.shift();c.total>c.threshold&&(console.debug("behaviour: thrashing seen"),e.post({type:5,customEvent:{name:"thrashing",data:{description:"Thrashing pointer",value:{amount:c.total}}}}),c.seen=[],c.total=0)}}return{init:function(){t=!1,i=e.getConfig(),a(),u(),v(),g(),b()},destroy:function(){t=!1},onevent:function(e){if("object"==typeof e&&e.type&&t){if("click"===e.type)return r(e),d(e),void m(e);if("error"!==e.type)if("scroll"!==e.type&&"orientationchange"!==e.type){if("mousemove"!==e.type)return"unload"===e.type?(r(e),d(e),m(e),p(e),void h(e)):void 0;h(e)}else p(e);else m(e)}},version:"1.0"}}));