TLT.addModule("frictionSigns",(function(e){"use strict";var t,i,n,o,s,c,l;function a(e,t){for(var i=0;i<t.length;i++)if("string"==typeof t[i]?-1!=e.indexOf(t[i]):e.match(t[i]))return!0;return!1}function r(e){(n=i.rageclick||{enable:!0}).enable&&(n.clicks=i.rageclick.clicks||4,n.distance=i.rageclick.distance||20,n.time=i.rageclick.time||800,n.blocklist=i.rageclick.blocklist||[],n.count=0,n.lastTime=0,t=!0)}function d(t){if("unload"!==t.type){if(!a(n.blocklist,t.target.id)){if(0===n.count||Math.abs(t.position.x-n.x)>n.distance||Math.abs(t.position.y-n.y)>n.distance||t.timestamp-n.lastTime>n.time)return n.x=t.position.x,n.y=t.position.y,n.count=1,void(n.lastTime=t.timestamp);n.count++,n.x=t.position.x,n.y=t.position.y,n.count===n.clicks&&(console.debug("frictionSigns: rage clicks seen"),e.post({type:5,customEvent:{name:"rageclick",data:{description:"Rage click - "+t.target.id,value:{target:t.target.id}}}}),n.count=0)}}else n.count=0}function u(e){(o=i.deadclick||{enable:!0}).enable&&(o.time=i.deadclick.time||2e3,o.blocklist=i.deadclick.blocklist||[],t=!0)}function g(t){if("click"===t.type){if("input"===t.target.type&&"button"!==t.target.subType||"select"===t.target.type||"label"===t.target.type)return;if(a(o.blocklist,t.target.id))return;var i=!0,n=t.target.id,s=new MutationObserver((function(){i=!1,s.disconnect()}));return s.observe(document.body,{subtree:!0,childList:!0,attributeFilter:["style","class"]}),void setTimeout((function t(){i&&(console.debug("frictionSigns: dead click seen"),e.post({type:5,customEvent:{name:"deadclick",data:{description:"Dead click - "+n,value:{target:n}}}}))}),o.time)}}function m(e){(s=i.errorclick||{enable:!0}).enable&&(s.time=i.errorclick.time||200,s.blocklist=i.errorclick.blocklist||[],s.target=null,s.clickTime=0,t=!0)}function p(t){if("click"===t.type)return s.target=t.target.id,void(s.clickTime=t.timestamp);if("error"!==t.type)"unload"===t.type&&(s.target=null);else{if(a(s.blocklist,t.target.id))return;if(s.target&&t.nativeEvent.message){if(t.timestamp-s.clickTime<s.time)return console.debug("frictionSigns: error click seen"),void e.post({type:5,customEvent:{name:"errorclick",data:{description:"Error click - "+s.target,value:{target:s.target,url:t.nativeEvent.filename,line:t.nativeEvent.lineno,description:t.nativeEvent.message}}}});s.target=null}}}function v(e){(c=i.excessscroll||{enable:!0}).enable&&(c.scale=i.excessscroll.scale||2.4,c.blocklist=i.excessscroll.blocklist||[],c.distance=0,c.lastpos=0,t=!0)}function f(t){if(!a(c.blocklist,t.target.id))return"scroll"===t.type?(c.distance+=Math.abs(window.scrollY-c.lastpos),c.lastpos=window.scrollY,void(c.distance>document.body.scrollHeight*c.scale&&(console.debug("frictionSigns: excess scroll seen"),e.post({type:5,customEvent:{name:"excessscroll",data:{description:"Excess scrolling",value:{distance:c.distance,pageheight:document.body.scrollHeight,viewport:window.visualViewport&&window.visualViewport.height?window.visualViewport.height:0}}}}),c.distance=0))):"orientationchange"===t.type?(c.distance=window.scrollY,void(c.lastpos=window.scrollY)):void("unload"===t.type&&(c.distance=0,c.lastpos=0))}function b(e){(l=i.thrashing||{enable:!0}).enable&&(l.time=i.thrashing.time||4e3,l.blocklist=i.thrashing.blocklist||[],l.threshold=10*Math.PI,l.moves=0,l.x=0,l.y=0,l.lastDirection=0,l.total=0,l.seen=[],t=!0)}function k(t){if(!a(c.blocklist,t.target.id))if("mousemove"!==t.type)"unload"===t.type&&(l.seen=[],l.total=0,l.moves=0,l.x=0,l.y=0);else{if(l.x+=t.nativeEvent.movementX,l.y+=t.nativeEvent.movementY,l.moves++,l.moves<10)return;var i=Math.atan2(l.y,l.x);l.moves=0,l.x=0,l.y=0;var n=l.seen.length>0?Math.abs((i-l.lastDirection)%Math.PI):0;for(l.lastDirection=i,l.total+=n,l.seen.push({time:t.timestamp,delta:n});l.seen.length>1&&t.timestamp-l.seen[0].time>l.time;)l.total-=l.seen[0].delta,l.seen.shift();l.total>l.threshold&&(console.debug("frictionSigns: thrashing seen"),e.post({type:5,customEvent:{name:"thrashing",data:{description:"Thrashing pointer",value:{amount:l.total}}}}),l.seen=[],l.total=0)}}return{init:function(){t=!1,i=e.getConfig(),r(),u(),m(),v(),b()},destroy:function(){t=!1},onevent:function(e){if("object"==typeof e&&e.type&&t){if("click"===e.type)return d(e),g(e),void p(e);if("error"!==e.type)if("scroll"!==e.type&&"orientationchange"!==e.type){if("mousemove"!==e.type)return"unload"===e.type?(d(e),g(e),p(e),f(e),void k(e)):void 0;k(e)}else f(e);else p(e)}},version:"1.0"}}));