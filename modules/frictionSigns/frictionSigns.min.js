TLT.addModule("frictionSigns",(function(e){"use strict";var t,i,n,o,l,c,s;function a(e){(n=i.rageclick||{enable:!1}).enable&&(n.clicks=i.rageclick.clicks||4,n.distance=i.rageclick.distance||20,n.time=i.rageclick.time||800,n.blocklist=i.rageclick.blocklist||[],n.count=0,n.lastTime=0,t=!0)}function r(t){if("unload"!==t.type){for(var i=0;i<n.blocklist.length;i++)if(t.target.id.match(n.blocklist[i]))return;if(0===n.count||Math.abs(t.position.x-n.x)>n.distance||Math.abs(t.position.y-n.y)>n.distance||t.timestamp-n.lastTime>n.time)return n.x=t.position.x,n.y=t.position.y,void(n.count=1);n.count++,n.x=t.position.x,n.y=t.position.y,n.count===n.clicks&&(console.debug("frictionSigns: rage clicks seen"),e.post({type:5,customEvent:{name:"rageclick",data:{description:"Rage click - "+t.target.id,value:{target:t.target.id}}}}),n.count=0)}else n.count=0}function u(e){(o=i.deadclick||{enable:!1}).enable&&(o.time=i.deadclick.time||2e3,o.blocklist=i.deadclick.blocklist||[],o.unresolvedClick=!1,o.lastTime=0,t=!0)}function d(t){var i=null,n=null;if("click"===t.type){if(i)return;if("input"===t.target.type&&"button"!==t.target.subType||"select"===t.target.type||"label"===t.target.type)return;for(var l=0;l<o.blocklist.length;l++)if(t.target.id.match(o.blocklist[l]))return;return o.unresolvedClick=!0,o.target=t.target.id,(n=new MutationObserver((function(){o.unresolvedClick=!1,n.disconnect()}))).observe(document.body,{subtree:!0,childList:!0,attributeFilter:["style","class"]}),void(i=setTimeout((function t(){o.unresolvedClick&&(console.debug("frictionSigns: dead click seen"),e.post({type:5,customEvent:{name:"deadclick",data:{description:"Dead click - "+o.target,value:{target:o.target}}}})),i=null,o.unresolvedClick=!1}),o.time))}"unload"===t.type&&i&&(clearTimeout(i),i=null,o.unresolvedClick=!1)}function m(e){(l=i.errorclick||{enable:!1}).enable&&(l.time=i.errorclick.time||200,l.blocklist=i.errorclick.blocklist||[],l.target=null,l.clickTime=0,t=!0)}function g(t){if("click"===t.type)return l.target=t.target.id,void(l.clickTime=t.timestamp);if("error"!==t.type)"unload"===t.type&&(l.target=null);else{for(var i=0;i<l.blocklist.length;i++)if(t.nativeEvent.message.match(l.blocklist[i]))return;if(l.target&&t.nativeEvent.message){if(t.timestamp-l.clickTime<l.time)return console.debug("frictionSigns: error click seen"),void e.post({type:5,customEvent:{name:"errorclick",data:{description:"Error click - "+l.target,value:{target:l.target,url:t.nativeEvent.filename,line:t.nativeEvent.lineno,description:t.nativeEvent.message}}}});l.target=null}}}function v(e){(c=i.excessscroll||{enable:!1}).enable&&(c.scale=i.excessscroll.scale||2.4,c.blocklist=i.excessscroll.blocklist||[],c.distance=0,c.lastpos=0,t=!0)}function p(t){for(var i=0;i<c.blocklist.length;i++)if(document.location.href.match(c.blocklist[i]))return;return"scroll"===t.type?(c.distance+=Math.abs(window.scrollY-c.lastpos),c.lastpos=window.scrollY,void(c.distance>document.body.scrollHeight*c.scale&&(console.debug("frictionSigns: excess scroll seen"),e.post({type:5,customEvent:{name:"excessscroll",data:{description:"Excess scrolling",value:{distance:c.distance,pageheight:document.body.scrollHeight,viewport:window.visualViewport&&window.visualViewport.height?window.visualViewport.height:0}}}}),c.distance=0))):"orientationchange"===t.type?(c.distance=window.scrollY,void(c.lastpos=window.scrollY)):void("unload"===t.type&&(c.distance=0,c.lastpos=0))}function f(e){(s=i.thrashing||{enable:!1}).enable&&(s.time=i.thrashing.time||4e3,s.blocklist=i.thrashing.blocklist||[],s.threshold=10*Math.PI,s.moves=0,s.x=0,s.y=0,s.lastDirection=0,s.total=0,s.seen=[],t=!0)}function k(t){for(var i=0;i<s.blocklist.length;i++)if(document.location.href.match(s.blocklist[i]))return;if("mousemove"!==t.type)"unload"===t.type&&(s.seen=[],s.total=0,s.moves=0,s.x=0,s.y=0);else{if(s.x+=t.nativeEvent.movementX,s.y+=t.nativeEvent.movementY,s.moves++,s.moves<10)return;var n=Math.atan2(s.y,s.x);s.moves=0,s.x=0,s.y=0;var o=s.seen.length>0?Math.abs((n-s.lastDirection)%Math.PI):0;for(s.lastDirection=n,s.total+=o,s.seen.push({time:t.timestamp,delta:o});s.seen.length>1&&t.timestamp-s.seen[0].time>s.time;)s.total-=s.seen[0].delta,s.seen.shift();s.total>s.threshold&&(console.debug("frictionSigns: thrashing seen"),e.post({type:5,customEvent:{name:"thrashing",data:{description:"Thrashing pointer",value:{amount:s.total}}}}),s.seen=[],s.total=0)}}return{init:function(){t=!1,i=e.getConfig(),a(),u(),m(),v(),f()},destroy:function(){t=!1},onevent:function(e){if("object"==typeof e&&e.type&&t){if("click"===e.type)return r(e),d(e),void g(e);if("error"!==e.type)if("scroll"!==e.type&&"orientationchange"!==e.type){if("mousemove"!==e.type)return"unload"===e.type?(r(e),d(e),g(e),p(e),void k(e)):void 0;k(e)}else p(e);else g(e)}},version:"1.0"}}));
